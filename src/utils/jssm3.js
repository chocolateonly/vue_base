export function JSSM3(str){var binArr=str2bin(str2rstr_utf8(str));var groupNum=alignSM3(binArr,str.length);var v=new Array(8);v[0]=0x7380166f;v[1]=0x4914b2b9;v[2]=0x172442d7;v[3]=0xda8a0600;v[4]=0xa96f30bc;v[5]=0x163138aa;v[6]=0xe38dee4d;v[7]=0xb0fb0e4e;for(var i=0;i<groupNum;i++){v=compress(v,binArr,i)}return word2str(v,'')}export function word2str(words,seperator){var prefix=Array(8).join('0');for(var i=0;i<words.length;i++){words[i]=(prefix+(words[i]>>>0).toString(16)).slice(-8)}return words.join(seperator)}export function str2bin(str){var binary=new Array(str.length>>2);for(var i=0;i<str.length*8;i+=8){binary[i>>5]|=(str.charCodeAt(i/8)&0xFF)<<(24-i%32)}return binary}export function alignSM3(arr,strLen){arr[strLen>>2]|=0x80<<(24-strLen%4*8);var groupNum=((strLen+8)>>6)+1;var wordNum=groupNum*16;for(var i=(strLen>>2)+1;i<wordNum;i++){arr[i]=0}arr[wordNum-1]=strLen*8;return groupNum}export function p0(x){return x^bitRol(x,9)^bitRol(x,17)}export function p1(x){return x^bitRol(x,15)^bitRol(x,23)}export function bitRol(input,n){return(input<<n)|(input>>>(32-n))}export function compress(v,binArr,i){var w1=new Array(68);var w2=new Array(64);for(var j=0;j<68;j++){if(j<16){w1[j]=binArr[i*16+j]}else{w1[j]=p1(w1[j-16]^w1[j-9]^bitRol(w1[j-3],15))^bitRol(w1[j-13],7)^w1[j-6]}}for(var j=0;j<64;j++){w2[j]=w1[j]^w1[j+4]}var a=v[0];var b=v[1];var c=v[2];var d=v[3];var e=v[4];var f=v[5];var g=v[6];var h=v[7];var ss1;var ss2;var tt1;var tt2;for(var j=0;j<64;j++){ss1=bitRol(addAll(bitRol(a,12),e,bitRol(t(j),j)),7);ss2=ss1^bitRol(a,12);tt1=addAll(ff(a,b,c,j),d,ss2,w2[j]);tt2=addAll(gg(e,f,g,j),h,ss1,w1[j]);d=c;c=bitRol(b,9);b=a;a=tt1;h=g;g=bitRol(f,19);f=e;e=p0(tt2)}v[0]^=a;v[1]^=b;v[2]^=c;v[3]^=d;v[4]^=e;v[5]^=f;v[6]^=g;v[7]^=h;return v}export function t(j){if(0<=j&&j<16){return 0x79CC4519}else if(j<64){return 0x7A879D8A}}export function ff(x,y,z,j){if(0<=j&&j<16){return x^y^z}else if(j<64){return(x&y)|(x&z)|(y&z)}}export function gg(x,y,z,j){if(0<=j&&j<16){return x^y^z}else if(j<64){return(x&y)|(~x&z)}}export function safe_add(x,y){var lsw=(x&0xFFFF)+(y&0xFFFF);var msw=(x>>16)+(y>>16)+(lsw>>16);return(msw<<16)|(lsw&0xFFFF)}export function addAll(){var sum=0;for(var i=0;i<arguments.length;i++){sum=safe_add(sum,arguments[i])}return sum}export function str2rstr_utf8(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(0xD800<=x&&x<=0xDBFF&&0xDC00<=y&&y<=0xDFFF){x=0x10000+((x&0x03FF)<<10)+(y&0x03FF);i++}if(x<=0x7F){output+=String.fromCharCode(x)}else if(x<=0x7FF){output+=String.fromCharCode(0xC0|((x>>>6)&0x1F),0x80|(x&0x3F))}else if(x<=0xFFFF){output+=String.fromCharCode(0xE0|((x>>>12)&0x0F),0x80|((x>>>6)&0x3F),0x80|(x&0x3F))}else if(x<=0x1FFFFF){output+=String.fromCharCode(0xF0|((x>>>18)&0x07),0x80|((x>>>12)&0x3F),0x80|((x>>>6)&0x3F),0x80|(x&0x3F))}}return output}